{"version":3,"file":"metadataHelpers.cjs.js","mappings":"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","sources":["webpack://@toruslabs/metadata-helpers/webpack/bootstrap","webpack://@toruslabs/metadata-helpers/webpack/runtime/compat get default export","webpack://@toruslabs/metadata-helpers/webpack/runtime/define property getters","webpack://@toruslabs/metadata-helpers/webpack/runtime/hasOwnProperty shorthand","webpack://@toruslabs/metadata-helpers/webpack/runtime/make namespace object","webpack://@toruslabs/metadata-helpers/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@toruslabs/metadata-helpers/external commonjs2 \"@toruslabs/http-helpers\"","webpack://@toruslabs/metadata-helpers/external commonjs2 \"json-stable-stringify\"","webpack://@toruslabs/metadata-helpers/external commonjs2 \"elliptic\"","webpack://@toruslabs/metadata-helpers/external commonjs2 \"keccak\"","webpack://@toruslabs/metadata-helpers/./src/utils.ts","webpack://@toruslabs/metadata-helpers/./src/MetadataStorageLayer.ts","webpack://@toruslabs/metadata-helpers/external commonjs2 \"@toruslabs/eccrypto\"","webpack://@toruslabs/metadata-helpers/./src/webAuthnShareResolver.ts","webpack://@toruslabs/metadata-helpers/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/http-helpers\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"json-stable-stringify\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"elliptic\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"keccak\");","import { ec as EC } from \"elliptic\";\nimport createKeccakHash from \"keccak\";\n\nexport function keccak256(a: string | Buffer): Buffer {\n  return createKeccakHash(\"keccak256\").update(a).digest();\n}\n\nexport const ec = new EC(\"secp256k1\");\n","import { post, setAPIKey, setEmbedHost } from \"@toruslabs/http-helpers\";\nimport stringify from \"json-stable-stringify\";\n\nimport { ec, keccak256 } from \"./utils\";\n\nexport type PubKeyParams = {\n  pub_key_X: string;\n  pub_key_Y: string;\n};\n\nexport type MetadataParams = PubKeyParams & {\n  set_data: {\n    data: string;\n    timestamp: string;\n  };\n  signature: string;\n};\n\nclass MetadataStorageLayer {\n  public metadataHost: string;\n\n  public serverTimeOffset: number; // ms\n\n  constructor(metadataHost = \"https://metadata.tor.us\", serverTimeOffset = 0) {\n    this.metadataHost = metadataHost;\n    this.serverTimeOffset = serverTimeOffset;\n  }\n\n  static setAPIKey(apiKey: string): void {\n    setAPIKey(apiKey);\n  }\n\n  static setEmbedHost(embedHost: string): void {\n    setEmbedHost(embedHost);\n  }\n\n  generateMetadataParams(message: string, privateKeyHex: string): MetadataParams {\n    const key = ec.keyFromPrivate(privateKeyHex, \"hex\");\n    const setData = {\n      data: message,\n      timestamp: Math.floor(this.serverTimeOffset + Date.now() / 1000).toString(16),\n    };\n    const sig = key.sign(keccak256(stringify(setData)));\n    return {\n      pub_key_X: key.getPublic().getX().toString(\"hex\"),\n      pub_key_Y: key.getPublic().getY().toString(\"hex\"),\n      set_data: setData,\n      signature: Buffer.from(\n        sig.r.toString(16, 64) + sig.s.toString(16, 64) + (sig.recoveryParam?.toString(16).padStart(2, \"0\").slice(-2) ?? \"00\"),\n        \"hex\"\n      ).toString(\"base64\"),\n    };\n  }\n\n  generatePubKeyParams(privateKeyHex: string): PubKeyParams {\n    const key = ec.keyFromPrivate(privateKeyHex, \"hex\");\n    return {\n      pub_key_X: key.getPublic().getX().toString(\"hex\"),\n      pub_key_Y: key.getPublic().getY().toString(\"hex\"),\n    };\n  }\n\n  async setMetadata(data: MetadataParams, namespace: string | null, options?: RequestInit): Promise<string> {\n    const params = namespace !== null ? { ...data, namespace } : data;\n    const metadataResponse = await post<{ message: string }>(`${this.metadataHost}/set`, params, options, { useAPIKey: true });\n    return metadataResponse.message;\n  }\n\n  async getMetadata(pubKey: PubKeyParams, namespace: string | null, options?: RequestInit): Promise<string> {\n    const params = namespace !== null ? { ...pubKey, namespace } : pubKey;\n    const metadataResponse = await post<{ message: string }>(`${this.metadataHost}/get`, params, options, { useAPIKey: true });\n    return metadataResponse.message;\n  }\n}\n\nexport default MetadataStorageLayer;\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@toruslabs/eccrypto\");","import { decrypt, Ecies, encrypt, getPublic } from \"@toruslabs/eccrypto\";\n\nimport MetadataStorageLayer, { PubKeyParams } from \"./MetadataStorageLayer\";\nimport { ec } from \"./utils\";\n\nconst WEBAUTHN_TORUS_SHARE = \"webauthn_torus_share\";\nconst WEBAUTHN_DEVICE_SHARE = \"webauthn_device_share\";\n\nexport type EciesHex = {\n  iv: string;\n  ephemPublicKey: string;\n  ciphertext: string;\n  mac: string;\n};\n\nexport function encParamsHexToBuf(encParamsHex: EciesHex): Ecies {\n  return {\n    iv: Buffer.from(encParamsHex.iv, \"hex\"),\n    ephemPublicKey: Buffer.from(encParamsHex.ephemPublicKey, \"hex\"),\n    ciphertext: Buffer.from(encParamsHex.ciphertext, \"hex\"),\n    mac: Buffer.from(encParamsHex.mac, \"hex\"),\n  };\n}\n\nexport function encParamsBufToHex(encParams: Ecies): EciesHex {\n  return {\n    iv: Buffer.from(encParams.iv).toString(\"hex\"),\n    ephemPublicKey: Buffer.from(encParams.ephemPublicKey).toString(\"hex\"),\n    ciphertext: Buffer.from(encParams.ciphertext).toString(\"hex\"),\n    mac: Buffer.from(encParams.mac).toString(\"hex\"),\n  };\n}\n\nexport async function encryptData(privKeyHex: string, d: unknown): Promise<string> {\n  const serializedDec = JSON.stringify(d);\n  const serializedBuf = Buffer.from(serializedDec, \"utf-8\");\n  const encParams = await encrypt(getPublic(Buffer.from(privKeyHex, \"hex\")), serializedBuf);\n  const encParamsHex = encParamsBufToHex(encParams);\n  const sData = JSON.stringify(encParamsHex);\n  return sData;\n}\n\nexport async function decryptData<T>(privKeyHex: string, d: string): Promise<T> {\n  const encParamsHex: EciesHex = JSON.parse(d);\n  const encParams = encParamsHexToBuf(encParamsHex);\n  const keyPair = ec.keyFromPrivate(privKeyHex);\n  const serializedBuf = await decrypt(Buffer.from(keyPair.getPrivate().toString(\"hex\", 64), \"hex\"), encParams);\n  const serializedDec = serializedBuf.toString(\"utf-8\");\n  const data: T = JSON.parse(serializedDec);\n  return data;\n}\n\nexport async function getAndDecryptData<T>(m: MetadataStorageLayer, privKeyHex: string, namespace: string): Promise<Record<string, T> | null> {\n  const keyPair = ec.keyFromPrivate(privKeyHex);\n  const pubKey = keyPair.getPublic();\n  const serializedData = await m.getMetadata({ pub_key_X: pubKey.getX().toString(16), pub_key_Y: pubKey.getY().toString(16) }, namespace);\n  if (!serializedData) {\n    return null;\n  }\n  const data = await decryptData<T>(privKeyHex, serializedData);\n  return data as Record<string, T>;\n}\n\nexport async function encryptAndSetData(m: MetadataStorageLayer, privKeyHex: string, d: Record<string, unknown>, namespace: string): Promise<void> {\n  const sData = await encryptData(privKeyHex, d);\n  const metadataParams = m.generateMetadataParams(sData, privKeyHex);\n  await m.setMetadata(metadataParams, namespace);\n}\n\nexport async function setTorusShare(\n  m: MetadataStorageLayer,\n  webAuthnPubKey: PubKeyParams,\n  webAuthnRefHex: string,\n  subspace: string,\n  subspaceData: unknown\n): Promise<void> {\n  const refKeyPair = ec.keyFromPrivate(webAuthnRefHex);\n  const privKey = refKeyPair.getPrivate();\n  const pubKey = ec.keyFromPublic({\n    x: webAuthnPubKey.pub_key_X,\n    y: webAuthnPubKey.pub_key_Y,\n  });\n  const data = await getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_TORUS_SHARE);\n  let d: Record<string, unknown> = {};\n  if (data) d = data;\n  const serializedSubspaceData = JSON.stringify(subspaceData);\n  const serializedSubspaceDataBuf = Buffer.from(serializedSubspaceData, \"utf-8\");\n  const encSubspaceData = await encrypt(Buffer.from(pubKey.getPublic(\"hex\"), \"hex\"), serializedSubspaceDataBuf);\n  const encSubspaceDataHex = encParamsBufToHex(encSubspaceData);\n  d[subspace] = encSubspaceDataHex;\n  await encryptAndSetData(m, privKey.toString(\"hex\", 64), d, WEBAUTHN_TORUS_SHARE);\n}\n\nexport async function setDeviceShare(m: MetadataStorageLayer, webAuthnRefHex: string, subspace: string, subspaceData: unknown): Promise<void> {\n  const keyPair = ec.keyFromPrivate(webAuthnRefHex);\n  const privKey = keyPair.getPrivate();\n  const data = await getAndDecryptData(m, webAuthnRefHex, WEBAUTHN_DEVICE_SHARE);\n  let d: Record<string, unknown> = {};\n  if (data) d = data;\n  d[subspace] = subspaceData;\n  await encryptAndSetData(m, privKey.toString(\"hex\", 64), d, WEBAUTHN_DEVICE_SHARE);\n}\n\nexport async function getTorusShare<T>(m: MetadataStorageLayer, webAuthnKeyHex: string, webAuthnRefHex: string, subspace: string): Promise<T | null> {\n  const data = await getAndDecryptData<EciesHex>(m, webAuthnRefHex, WEBAUTHN_TORUS_SHARE);\n  if (!data) return null;\n  const encParamsHex = data[subspace];\n  if (!encParamsHex) return null;\n  const encParams = encParamsHexToBuf(encParamsHex);\n  const keyPair = ec.keyFromPrivate(webAuthnKeyHex);\n  const privKey = keyPair.getPrivate();\n  const serializedSubspaceDataBuf = await decrypt(Buffer.from(privKey.toString(\"hex\", 64), \"hex\"), encParams);\n  const serializedSubspaceData = serializedSubspaceDataBuf.toString(\"utf-8\");\n  const subspaceData = JSON.parse(serializedSubspaceData);\n  return subspaceData;\n}\n\nexport async function getDeviceShare<T>(m: MetadataStorageLayer, webAuthnRefHex: string, subspace: string): Promise<T | null> {\n  const data = await getAndDecryptData<T>(m, webAuthnRefHex, WEBAUTHN_DEVICE_SHARE);\n  if (data) return data[subspace];\n  return null;\n}\n","export * from \"./MetadataStorageLayer\";\nexport { default } from \"./MetadataStorageLayer\";\nexport * from \"./utils\";\nexport * from \"./webAuthnShareResolver\";\n"],"names":["ec","EC","createKeccakHash","keccak256","a","update","digest","post","setAPIKey","setEmbedHost","stringify","MetadataStorageLayer","constructor","metadataHost","arguments","length","undefined","serverTimeOffset","_defineProperty","apiKey","embedHost","generateMetadataParams","message","privateKeyHex","key","keyFromPrivate","setData","data","timestamp","Math","floor","Date","now","toString","sig","sign","pub_key_X","getPublic","getX","pub_key_Y","getY","set_data","signature","Buffer","from","r","s","recoveryParam","padStart","slice","generatePubKeyParams","setMetadata","namespace","options","params","_objectSpread","metadataResponse","useAPIKey","getMetadata","pubKey","decrypt","encrypt","WEBAUTHN_TORUS_SHARE","WEBAUTHN_DEVICE_SHARE","encParamsHexToBuf","encParamsHex","iv","ephemPublicKey","ciphertext","mac","encParamsBufToHex","encParams","encryptData","privKeyHex","d","serializedDec","JSON","serializedBuf","sData","decryptData","parse","keyPair","getPrivate","getAndDecryptData","m","serializedData","encryptAndSetData","metadataParams","setTorusShare","webAuthnPubKey","webAuthnRefHex","subspace","subspaceData","refKeyPair","privKey","keyFromPublic","x","y","serializedSubspaceData","serializedSubspaceDataBuf","encSubspaceData","encSubspaceDataHex","setDeviceShare","getTorusShare","webAuthnKeyHex","getDeviceShare","default"],"sourceRoot":""}