{"version":3,"file":"baseEvmAdapter.cjs.js","mappings":"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","sources":["webpack://@web3auth/base-evm-adapter/webpack/bootstrap","webpack://@web3auth/base-evm-adapter/webpack/runtime/compat get default export","webpack://@web3auth/base-evm-adapter/webpack/runtime/define property getters","webpack://@web3auth/base-evm-adapter/webpack/runtime/hasOwnProperty shorthand","webpack://@web3auth/base-evm-adapter/webpack/runtime/make namespace object","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/asyncToGenerator\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/classCallCheck\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/createClass\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/assertThisInitialized\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/inherits\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/possibleConstructorReturn\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/getPrototypeOf\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/helpers/defineProperty\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@babel/runtime/regenerator\"","webpack://@web3auth/base-evm-adapter/external commonjs2 \"@web3auth/base\"","webpack://@web3auth/base-evm-adapter/./src/baseEvmAdapter.ts","webpack://@web3auth/base-evm-adapter/./src/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/asyncToGenerator\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/classCallCheck\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/createClass\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/assertThisInitialized\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/inherits\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/possibleConstructorReturn\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/getPrototypeOf\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/helpers/defineProperty\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@babel/runtime/regenerator\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@web3auth/base\");","import {\n  ADAPTER_STATUS,\n  BaseAdapter,\n  checkIfTokenIsExpired,\n  clearToken,\n  getSavedToken,\n  saveToken,\n  signChallenge,\n  UserAuthInfo,\n  verifySignedChallenge,\n  WalletLoginError,\n} from \"@web3auth/base\";\n\nexport abstract class BaseEvmAdapter<T> extends BaseAdapter<T> {\n  public clientId: string;\n\n  constructor(params: { clientId?: string } = {}) {\n    super();\n    this.clientId = params.clientId;\n  }\n\n  async authenticateUser(): Promise<UserAuthInfo> {\n    if (!this.provider || !this.chainConfig?.chainId) throw WalletLoginError.notConnectedError();\n    const { chainNamespace, chainId } = this.chainConfig;\n\n    if (this.status !== ADAPTER_STATUS.CONNECTED) throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n    const accounts = await this.provider.request<string[]>({\n      method: \"eth_accounts\",\n    });\n    if (accounts && accounts.length > 0) {\n      const existingToken = getSavedToken(accounts[0] as string, this.name);\n      if (existingToken) {\n        const isExpired = checkIfTokenIsExpired(existingToken);\n        if (!isExpired) {\n          return { idToken: existingToken };\n        }\n      }\n\n      const payload = {\n        domain: window.location.origin,\n        uri: window.location.href,\n        address: accounts[0],\n        chainId: parseInt(chainId, 16),\n        version: \"1\",\n        nonce: Math.random().toString(36).slice(2),\n        issuedAt: new Date().toISOString(),\n      };\n\n      const challenge = await signChallenge(payload, chainNamespace);\n\n      const signedMessage = await this.provider.request<string>({\n        method: \"personal_sign\",\n        params: [challenge, accounts[0]],\n      });\n\n      const idToken = await verifySignedChallenge(chainNamespace, signedMessage as string, challenge, this.name, this.sessionTime, this.clientId);\n      saveToken(accounts[0] as string, this.name, idToken);\n      return {\n        idToken,\n      };\n    }\n    throw WalletLoginError.notConnectedError(\"Not connected with wallet, Please login/connect first\");\n  }\n\n  async disconnect(): Promise<void> {\n    if (this.status !== ADAPTER_STATUS.CONNECTED) throw WalletLoginError.disconnectionError(\"Not connected with wallet\");\n    const accounts = await this.provider.request<string[]>({\n      method: \"eth_accounts\",\n    });\n    if (accounts && accounts.length > 0) {\n      clearToken(accounts[0], this.name);\n    }\n  }\n}\n","export * from \"./baseEvmAdapter\";\n"],"names":["ADAPTER_STATUS","BaseAdapter","checkIfTokenIsExpired","clearToken","getSavedToken","saveToken","signChallenge","verifySignedChallenge","WalletLoginError","BaseEvmAdapter","params","clientId","provider","chainConfig","chainId","notConnectedError","chainNamespace","status","CONNECTED","request","method","accounts","length","existingToken","name","isExpired","idToken","payload","domain","window","location","origin","uri","href","address","parseInt","version","nonce","Math","random","toString","slice","issuedAt","Date","toISOString","challenge","signedMessage","sessionTime","disconnectionError"],"sourceRoot":""}