"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.buildMultiSendSmartAccountTx = exports.encodeMultiSend = exports.buildSmartAccountTransaction = exports.buildContractCall = void 0;
const ethers_1 = require("ethers");
const constants_1 = require("@ethersproject/constants");
/* eslint-disable  @typescript-eslint/no-explicit-any */
const buildContractCall = (contract, method, params, nonce, delegateCall, overrides) => {
    const data = contract.interface.encodeFunctionData(method, params);
    return (0, exports.buildSmartAccountTransaction)(Object.assign({
        to: contract.address,
        data,
        operation: delegateCall ? 1 : 0,
        nonce
    }, overrides));
};
exports.buildContractCall = buildContractCall;
const buildSmartAccountTransaction = (template) => {
    return {
        to: template.to,
        value: template.value || 0,
        data: template.data || '0x',
        operation: template.operation || 0,
        targetTxGas: template.targetTxGas || 0,
        baseGas: template.baseGas || 0,
        gasPrice: template.gasPrice || 0,
        gasToken: template.gasToken || constants_1.AddressZero,
        refundReceiver: template.refundReceiver || constants_1.AddressZero,
        nonce: template.nonce
    };
};
exports.buildSmartAccountTransaction = buildSmartAccountTransaction;
const encodeMetaTransaction = (tx) => {
    const data = ethers_1.utils.arrayify(tx.data);
    const encoded = ethers_1.utils.solidityPack(['uint8', 'address', 'uint256', 'uint256', 'bytes'], [tx.operation, tx.to, tx.value, data.length, data]);
    return encoded.slice(2);
};
const encodeMultiSend = (txs) => {
    return '0x' + txs.map((tx) => encodeMetaTransaction(tx)).join('');
};
exports.encodeMultiSend = encodeMultiSend;
const buildMultiSendSmartAccountTx = (multiSend, txs, nonce, overrides) => {
    return (0, exports.buildContractCall)(multiSend, 'multiSend', [(0, exports.encodeMultiSend)(txs)], nonce, true, overrides);
};
exports.buildMultiSendSmartAccountTx = buildMultiSendSmartAccountTx;
//# sourceMappingURL=MultiSend.js.map